<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Nutricious — Landing & QR Controller</title>
  <style>
    :root{
      --bg:linear-gradient(180deg,#f2fff4,#eaf9ef);
      --page-bg:#f6fff6;
      --card:#ffffff;
      --accent:#0f7a3a;
      --accent-2:#2aa34a;
      --muted:#556b58;
      --accent-contrast:#fff;
      --offer-bg:#fff7e6;
      --offer-border:#ffd58a;
    }
    body{font-family:Inter, system-ui, -apple-system, Arial; background:var(--page-bg);margin:0;padding:18px;color:#0b2b1a}
    .container{max-width:920px;margin:14px auto;padding:20px;background:var(--card);border-radius:12px;box-shadow:0 8px 30px rgba(10,10,10,0.06);border-top:6px solid var(--accent-2)}
    header{display:flex;gap:12px;align-items:center}
    header img.logo{width:72px;height:72px;object-fit:contain;border-radius:12px;border:2px solid rgba(15,122,58,0.08)}
    h1{margin:0;font-size:20px}
    .tagline{color:var(--muted);margin-top:6px;font-weight:600}
    .grid{display:grid;grid-template-columns:1fr 380px;gap:18px;margin-top:18px}
    .card{background:var(--card);padding:14px;border-radius:10px;border:1px solid rgba(10,20,10,0.03)}
    .menu-list{list-style:none;padding:0;margin:0}
    .menu-list li{display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px dashed #eef6ee}
    label{display:block;font-size:13px;color:var(--muted);margin-top:10px}
    input[type=text], textarea{width:100%;padding:8px;border-radius:8px;border:1px solid #e0e6e0}
    .btn{background:var(--accent);color:var(--accent-contrast);padding:10px 12px;border-radius:8px;border:0;cursor:pointer;box-shadow:0 6px 18px rgba(15,122,58,0.12)}
    .muted{color:var(--muted);font-size:13px}
    .star{font-size:28px;cursor:pointer;color:#e6b422}
    .qrwrap{text-align:center}
    .admin-badge{font-size:12px;color:#fff;background:var(--accent);padding:6px 8px;border-radius:999px}
    footer{margin-top:12px;font-size:13px;color:var(--muted)}
    .small{font-size:12px;color:var(--muted)}
    .admin-panel{display:none;}
    .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    .link-btn{background:white;border:1px solid #dfeee0;padding:8px;border-radius:8px;cursor:pointer}
    .csv-list{max-height:140px;overflow:auto;padding:8px;background:#fcfff8;border-radius:8px;border:1px solid #eef7ee}

    /* Offers banner */
    .offers-banner{background:linear-gradient(90deg,var(--offer-bg),#fff3e6);border-radius:10px;padding:12px;border:2px solid var(--offer-border);margin-top:12px}
    .offers-banner h4{margin:0;color:var(--accent);font-size:16px}
    .offers-banner p{margin:6px 0 0;font-weight:700;color:#7a4a00}

    /* emphasize offers inside aside */
    .offers-highlight{background:linear-gradient(90deg, rgba(42,163,74,0.08), rgba(15,122,58,0.04));padding:12px;border-radius:8px;border:1px solid rgba(15,122,58,0.07)}
    .offers-text{font-size:16px;font-weight:700;color:var(--accent)}

    @media (max-width:900px){ .grid{grid-template-columns:1fr} header img.logo{width:64px;height:64px} }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <img class="logo" id="logoImg" src="https://via.placeholder.com/150x150.png?text=Nutricious" alt="logo">
      <div>
        <h1>Nutricious <span class="admin-badge" id="envBadge">Live</span></h1>
        <div class="tagline" id="tagline">Your protein, your way. Anytime.</div>
      </div>
      <div style="margin-left:auto;text-align:right">
        <div class="small">Quick admin</div>
        <button class="link-btn" id="openAdmin">Open admin</button>
      </div>
    </header>

    <div class="grid">
      <main>
        <section class="card">
          <h3>Menu</h3>
          <ul class="menu-list" id="menuList">
            <!-- menu items rendered here -->
          </ul>
          <div class="small muted">Prices & items are editable from Admin → Save → Generate QR.</div>
        </section>

        <section class="card" style="margin-top:12px">
          <h3>Feedback</h3>
          <textarea id="feedbackText" rows="3" placeholder="Tell us about the shake, taste, service..." ></textarea>
          <div style="margin-top:10px;display:flex;align-items:center;gap:10px">
            <div id="stars" title="Rate us">
              <span class="star" data-value="1">☆</span>
              <span class="star" data-value="2">☆</span>
              <span class="star" data-value="3">☆</span>
              <span class="star" data-value="4">☆</span>
              <span class="star" data-value="5">☆</span>
            </div>
            <button class="btn" id="submitFeedback">Send Feedback</button>
          </div>
          <div class="small muted" style="margin-top:8px">All feedback is stored locally and can be exported by admin.</div>
        </section>

      </main>

      <aside></aside>
    </div>

    <footer>
      This single-file page stores editable configuration in the URL hash and localStorage so the QR can point to a shareable version of this same page. Use the admin panel to change items → click "Generate QR" to update.
    </footer>
  </div>

  <!-- QR library (lightweight) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script>
    // Default config
    const defaultConfig = {
      logo: 'https://via.placeholder.com/150x150.png?text=Nutricious',
      tagline: 'Your protein, your way. Anytime.',
      menu: [ {name:'Whey Protein Shake', price:'150'}, {name:'Pre-Workout Shot', price:'89'} ],
      offers: 'FIRST USER: ₹10 OFF. MEMBERS: Buy 10 → Get 1 FREE',
      env: 'live'
    };

    // Utilities
    function saveLocal(cfg){ localStorage.setItem('nutricious_cfg', JSON.stringify(cfg)); }
    function loadLocal(){ const s = localStorage.getItem('nutricious_cfg'); return s ? JSON.parse(s) : null; }

    function applyConfig(cfg){
      document.getElementById('logoImg').src = cfg.logo;
      document.getElementById('tagline').textContent = cfg.tagline;
      document.getElementById('offers').textContent = cfg.offers;
      document.getElementById('envBadge').textContent = cfg.env === 'live' ? 'Live' : cfg.env;

      // render menu
      const menuList = document.getElementById('menuList'); menuList.innerHTML='';
      cfg.menu.forEach(item=>{
        const li = document.createElement('li');
        const name = document.createElement('div'); name.textContent = item.name;
        const price = document.createElement('div'); price.textContent = '₹'+item.price;
        li.appendChild(name); li.appendChild(price); menuList.appendChild(li);
      });

      // admin textarea values
      document.getElementById('adminLogo').value = cfg.logo;
      document.getElementById('adminTagline').value = cfg.tagline;
      document.getElementById('adminMenuJson').value = JSON.stringify(cfg.menu, null, 2);
      document.getElementById('adminOffers').value = cfg.offers;

      // also highlight offers area visually
      const offersEl = document.getElementById('offers'); if(offersEl) offersEl.innerHTML = cfg.offers;
    }

    function encodeConfigToHash(cfg){
      const s = btoa(unescape(encodeURIComponent(JSON.stringify(cfg))));
      return '#cfg='+s;
    }
    function decodeConfigFromHash(){
      try{
        const h = location.hash || '';
        if(!h.startsWith('#cfg=')) return null;
        const b = h.slice(5);
        const json = decodeURIComponent(escape(atob(b)));
        return JSON.parse(json);
      }catch(e){return null}
    }

    // QR generation
    let qrObj = null;
    function generateQR(url){
      const container = document.getElementById('qrcode'); container.innerHTML='';
      // use external API to make downloadable QR image (and also draw via qrcodejs)
      const encoded = encodeURIComponent(url);
      const apiUrl = 'https://api.qrserver.com/v1/create-qr-code/?size=300x300&data='+encoded;
      // show image
      const img = document.createElement('img'); img.src = apiUrl; img.alt='QR'; img.width=260; img.height=260; img.style.borderRadius='10px';
      container.appendChild(img);
      // also keep a qrcodejs object hidden for fallback
      // (not required but left here if needed)
      qrObj = apiUrl; // store url for download
    }

    // feedback handling
    function loadFeedback(){ const fb = JSON.parse(localStorage.getItem('nutricious_feedback')||'[]'); return fb; }
    function saveFeedback(arr){ localStorage.setItem('nutricious_feedback', JSON.stringify(arr)); }
    function addFeedback(text,stars){ const arr = loadFeedback(); arr.push({text,stars,ts:new Date().toISOString()}); saveFeedback(arr); renderFeedbackList(); }
    function renderFeedbackList(){ const arr = loadFeedback(); const el = document.getElementById('feedbackList'); if(arr.length===0){ el.textContent='No feedback yet'; return;} el.innerHTML = ''; arr.slice().reverse().forEach(f => {
        const d = document.createElement('div'); d.style.marginBottom='6px'; d.innerHTML = `<b>${f.stars}★</b> · ${new Date(f.ts).toLocaleString()}<div class="small">${escapeHtml(f.text)}</div>`; el.appendChild(d);
      }); }

    function escapeHtml(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

    // init
    (function init(){
      const hashCfg = decodeConfigFromHash();
      const localCfg = loadLocal();
      const cfg = hashCfg || localCfg || defaultConfig;
      applyConfig(cfg);
      // generate QR for this page + config in hash
      const newHash = encodeConfigToHash(cfg);
      const fullUrl = location.origin + location.pathname + newHash;
      generateQR(fullUrl);
      renderFeedbackList();

      // star rating ui
      const stars = document.querySelectorAll('.star'); let selectedStars = 0;
      stars.forEach(s => {
        s.addEventListener('mouseover', ()=>{ const v = +s.dataset.value; highlightStars(v); });
        s.addEventListener('mouseout', ()=>{ highlightStars(selectedStars); });
        s.addEventListener('click', ()=>{ selectedStars = +s.dataset.value; highlightStars(selectedStars); });
      });
      function highlightStars(n){ stars.forEach(s=>{ s.textContent = (+s.dataset.value <= n) ? '★' : '☆'; }); }

      // feedback submit
      document.getElementById('submitFeedback').addEventListener('click', ()=>{
        const text = document.getElementById('feedbackText').value.trim();
        if(!text){ alert('Please write a short feedback.'); return; }
        addFeedback(text, selectedStars||0);
        document.getElementById('feedbackText').value=''; selectedStars=0; highlightStars(0);
        alert('Thanks for your feedback!');
      });

      // admin open
      document.getElementById('openAdmin').addEventListener('click', ()=>{
        const pwd = localStorage.getItem('nutricious_admin_pwd') || 'admin';
        const input = prompt('Enter admin password to open panel:');
        if(input === pwd){ document.getElementById('adminPanel').style.display='block'; window.scrollTo({top:document.getElementById('adminPanel').offsetTop, behavior:'smooth'}); }
        else alert('Wrong password');
      });

      // save config
      document.getElementById('saveConfig').addEventListener('click', ()=>{
        try{
          const newCfg = {
            logo: document.getElementById('adminLogo').value || defaultConfig.logo,
            tagline: document.getElementById('adminTagline').value || defaultConfig.tagline,
            menu: JSON.parse(document.getElementById('adminMenuJson').value),
            offers: document.getElementById('adminOffers').value || defaultConfig.offers,
            env: 'live'
          };
          const pwdField = document.getElementById('adminPassword').value;
          if(pwdField){ localStorage.setItem('nutricious_admin_pwd', pwdField); alert('Admin password updated'); }
          saveLocal(newCfg);
          applyConfig(newCfg);
          alert('Config saved locally. Click Generate QR to update shareable QR.');
        }catch(e){ alert('Invalid menu JSON, fix it.'); }
      });

      // generate QR button
      document.getElementById('regenQR').addEventListener('click', ()=>{
        const cfg = loadLocal() || defaultConfig;
        const newHash = encodeConfigToHash(cfg);
        const fullUrl = location.origin + location.pathname + newHash;
        // replace URL hash (without reloading)
        history.replaceState(null, '', fullUrl);
        generateQR(fullUrl);
        alert('QR updated — scan to open the shareable page with current menu and offers.');
      });

      // download QR
      document.getElementById('downloadQR').addEventListener('click', ()=>{
        if(!qrObj){ alert('No QR found'); return; }
        // open image URL in new tab so user can save
        window.open(qrObj, '_blank');
      });

      document.getElementById('openLink').addEventListener('click', ()=>{
        const cfg = loadLocal() || defaultConfig;
        const fullUrl = location.origin + location.pathname + encodeConfigToHash(cfg);
        window.open(fullUrl, '_blank');
      });

      // export/import config
      document.getElementById('exportConfig').addEventListener('click', ()=>{
        const cfg = loadLocal() || defaultConfig; const blob = new Blob([JSON.stringify(cfg, null, 2)], {type:'application/json'}); const url = URL.createObjectURL(blob);
        const a = document.createElement('a'); a.href = url; a.download = 'nutricious-config.json'; a.click(); URL.revokeObjectURL(url);
      });
      document.getElementById('importConfig').addEventListener('click', ()=>{
        const data = prompt('Paste JSON config here'); if(!data) return; try{ const cfg = JSON.parse(data); saveLocal(cfg); applyConfig(cfg); alert('Config imported. Click Generate QR to update.'); }catch(e){ alert('Invalid JSON'); }});

      // export feedback
      document.getElementById('exportFeedback').addEventListener('click', ()=>{
        const arr = loadFeedback(); if(arr.length===0){ alert('No feedback'); return; }
        const csv = ['ts,stars,feedback'].concat(arr.map(r=>`"${r.ts}",${r.stars},"${(r.text||'').replace(/"/g,'""')}"`)).join('
');
        const blob = new Blob([csv], {type:'text/csv'}); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = 'feedback.csv'; a.click(); URL.revokeObjectURL(url);
      });

      document.getElementById('clearFeedback').addEventListener('click', ()=>{ if(confirm('Clear all local feedback?')){ localStorage.removeItem('nutricious_feedback'); renderFeedbackList(); }});

    })();
  </script>
</body>
</html>
